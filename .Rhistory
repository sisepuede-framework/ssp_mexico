head(att)
dim(data_new)
data_new <- merge(data_new,att,by="primary_id")
dim(data_new)
atts <- read.csv(paste0(dir.output,"ATTRIBUTE_STRATEGY.csv"))
#merge
dim(data_new)
data_new <- merge(data_new,atts[c("strategy_id","strategy")],by="strategy_id")
dim(data_new)
#melt edgar data
id_varsEd <- c("Code","mex_sector","mex_subsector","Gas","ID")
measure.vars_Ed <- subset(colnames(edgar),grepl("X",colnames(edgar))==TRUE)
edgar <- data.table(edgar)
edgar <- melt(edgar, id.vars = id_varsEd, measure.vars =measure.vars_Ed)
edgar <- data.frame(edgar)
edgar$Year <- as.numeric(gsub("X","",edgar$variable))
#make sure both data frames have the same columns
#edgar
edgar$variable <- NULL
edgar$strategy_id <- NA
edgar$primary_id <- NA
edgar$design_id <- NA
edgar$future_id <- NA
edgar$Contry <- Country
edgar$strategy <- "Historical"
edgar$source <- "EDGAR"
edgar <- subset(edgar,Year<=max(edgar$Year))
#data_new
data_new$time_period <- NULL
data_new$Code <- iso_code3
data_new$Contry <- Country
data_new$source <- "SISEPUEDE"
data_new <- subset(data_new,Year>=max(edgar$Year))
#rbind both
data_new <- rbind(data_new,edgar)
data_new <- data_new[order(data_new$strategy_id,
data_new$mex_subsector,
data_new$Gas,
data_new$Year),]
View(data_new)
max(edgar$Year)
table(edgar$Year, exclude = NULL)
# This script prepares the data for emissions mapping in Uganda
file.name <- paste0("decomposed_ssp_output.csv")
iso_code3 <- iso_code3
Country <- region
mapping <- read.csv("ssp_modeling/output_postprocessing/data/inventory/emission_targets_MEX_2023_ni.csv")
# drop "id" directly
mapping$id <- NULL
# drop the column whose name is stored in iso_code3
mapping[[iso_code3]] <- NULL
# names(mapping)
# modification of AG - Livestock:N2O subsector matching
# mapping$Vars[3] <- "emission_co2e_n2o_lsmm_direct_anaerobic_digester:emission_co2e_n2o_lsmm_direct_anaerobic_lagoon:emission_co2e_n2o_lsmm_direct_composting:emission_co2e_n2o_lsmm_direct_daily_spread:emission_co2e_n2o_lsmm_direct_deep_bedding:emission_co2e_n2o_lsmm_direct_dry_lot:emission_co2e_n2o_lsmm_direct_incineration:emission_co2e_n2o_lsmm_direct_liquid_slurry:emission_co2e_n2o_lsmm_direct_paddock_pasture_range:emission_co2e_n2o_lsmm_direct_poultry_manure:emission_co2e_n2o_lsmm_direct_storage_solid:emission_co2e_n2o_lsmm_indirect_anaerobic_digester:emission_co2e_n2o_lsmm_indirect_anaerobic_lagoon:emission_co2e_n2o_lsmm_indirect_composting:emission_co2e_n2o_lsmm_indirect_daily_spread:emission_co2e_n2o_lsmm_indirect_deep_bedding:emission_co2e_n2o_lsmm_indirect_dry_lot:emission_co2e_n2o_lsmm_indirect_incineration:emission_co2e_n2o_lsmm_indirect_liquid_slurry:emission_co2e_n2o_lsmm_indirect_paddock_pasture_range:emission_co2e_n2o_lsmm_indirect_poultry_manure:emission_co2e_n2o_lsmm_indirect_storage_solid"
# add edgar
edgar <- read.csv("ssp_modeling/output_postprocessing/data/inventory/INEGyCEI_historico_wide.csv")
dim(edgar)
edgar <- subset(edgar,Code==iso_code3)
edgar$ID<- paste(edgar$mex_subsector,edgar$Gas,sep=":")
#load data
data <- fread(paste0(dir.output,file.name)) %>% as.data.frame()
data <- subset(data,region==Country)
dim(data)
#order data
setorder(data, primary_id, time_period, region)
#emission vars only
id_vars <-c('region','time_period',"primary_id")
vars <- subset(colnames(data),!(colnames(data)%in%id_vars))
target_vars <- subset(vars,grepl("co2e_",vars)==TRUE)
total_vars <- subset(target_vars,grepl("emission_co2e_subsector_total",target_vars)==TRUE)
target_vars <- subset(target_vars,!(target_vars%in%total_vars))
#load inventory mapping table
mapping$ids <- paste(row.names(mapping),mapping$subsector_ssp, mapping$gas,sep="_")
#now create those new columns in the simulation data set
for  (i in 1:nrow(mapping))
{
#i<- 63
tvars <- mapping$vars[i]
tvars <- unlist(strsplit(tvars,":"))
tvars <- subset(tvars,tvars%in%colnames(data))
if (length(tvars)>1) {
data [,mapping$ids[i]] <- rowSums(data[,tvars])
} else if (length(tvars)==1 )
{
data [,mapping$ids[i]] <- data[,tvars]
} else {
data [,mapping$ids[i]] <- 0
}
}
#now we just keep the new variables and the time period which we will reduce to above 2022
data_new <- data [,c(id_vars,mapping$ids)]
dim(data_new)
#convert from wide to long
data_new <- data.table(data_new)
data_new <- reshape2::melt(data_new, id.vars = id_vars,
measure.vars = mapping$ids,
)
data_new <- data.frame(data_new)
data_new$ids <- as.character(data_new$variable)
#merge with mapping
mapping$vars <- NULL
colnames(mapping) <- gsub("mex_sector","CSC.Sector",colnames(mapping))
colnames(mapping) <- gsub("mex_subsector","CSC.Subsector",colnames(mapping))
data_new <- merge(data_new, mapping,by="ids")
#now aggregare at inventory level
data_new <- aggregate(list(value=data_new$value),by=list(primary_id=data_new$primary_id,
time_period=data_new$time_period,
ID=data_new$ID,
mex_sector=data_new$CSC.Sector,
mex_subsector=data_new$CSC.Subsector),sum)
data_new$Year <- data_new$time_period + 2015
data_new$Gas <- do.call("rbind",strsplit(data_new$ID,":"))[,2]
#merge additional files
att <- read.csv(paste0(dir.output,"ATTRIBUTE_PRIMARY.csv"))
head(att)
dim(data_new)
data_new <- merge(data_new,att,by="primary_id")
dim(data_new)
atts <- read.csv(paste0(dir.output,"ATTRIBUTE_STRATEGY.csv"))
#merge
dim(data_new)
data_new <- merge(data_new,atts[c("strategy_id","strategy")],by="strategy_id")
dim(data_new)
#melt edgar data
id_varsEd <- c("Code","mex_sector","mex_subsector","Gas","ID")
measure.vars_Ed <- subset(colnames(edgar),grepl("X",colnames(edgar))==TRUE)
edgar <- data.table(edgar)
edgar <- melt(edgar, id.vars = id_varsEd, measure.vars =measure.vars_Ed)
edgar <- data.frame(edgar)
edgar$Year <- as.numeric(gsub("X","",edgar$variable))
View(edgar)
table(edgar$Year)
table(edgar$Year, exclude = NULL)
# This script prepares the data for emissions mapping in Uganda
file.name <- paste0("decomposed_ssp_output.csv")
iso_code3 <- iso_code3
Country <- region
mapping <- read.csv("ssp_modeling/output_postprocessing/data/inventory/emission_targets_MEX_2023_ni.csv")
# drop "id" directly
mapping$id <- NULL
# drop the column whose name is stored in iso_code3
mapping[[iso_code3]] <- NULL
# names(mapping)
# modification of AG - Livestock:N2O subsector matching
# mapping$Vars[3] <- "emission_co2e_n2o_lsmm_direct_anaerobic_digester:emission_co2e_n2o_lsmm_direct_anaerobic_lagoon:emission_co2e_n2o_lsmm_direct_composting:emission_co2e_n2o_lsmm_direct_daily_spread:emission_co2e_n2o_lsmm_direct_deep_bedding:emission_co2e_n2o_lsmm_direct_dry_lot:emission_co2e_n2o_lsmm_direct_incineration:emission_co2e_n2o_lsmm_direct_liquid_slurry:emission_co2e_n2o_lsmm_direct_paddock_pasture_range:emission_co2e_n2o_lsmm_direct_poultry_manure:emission_co2e_n2o_lsmm_direct_storage_solid:emission_co2e_n2o_lsmm_indirect_anaerobic_digester:emission_co2e_n2o_lsmm_indirect_anaerobic_lagoon:emission_co2e_n2o_lsmm_indirect_composting:emission_co2e_n2o_lsmm_indirect_daily_spread:emission_co2e_n2o_lsmm_indirect_deep_bedding:emission_co2e_n2o_lsmm_indirect_dry_lot:emission_co2e_n2o_lsmm_indirect_incineration:emission_co2e_n2o_lsmm_indirect_liquid_slurry:emission_co2e_n2o_lsmm_indirect_paddock_pasture_range:emission_co2e_n2o_lsmm_indirect_poultry_manure:emission_co2e_n2o_lsmm_indirect_storage_solid"
# add edgar
edgar <- read.csv("ssp_modeling/output_postprocessing/data/inventory/INEGyCEI_historico_wide.csv")
dim(edgar)
edgar <- subset(edgar,Code==iso_code3)
edgar$ID<- paste(edgar$mex_subsector,edgar$Gas,sep=":")
#load data
data <- fread(paste0(dir.output,file.name)) %>% as.data.frame()
data <- subset(data,region==Country)
dim(data)
#order data
setorder(data, primary_id, time_period, region)
#emission vars only
id_vars <-c('region','time_period',"primary_id")
vars <- subset(colnames(data),!(colnames(data)%in%id_vars))
target_vars <- subset(vars,grepl("co2e_",vars)==TRUE)
total_vars <- subset(target_vars,grepl("emission_co2e_subsector_total",target_vars)==TRUE)
target_vars <- subset(target_vars,!(target_vars%in%total_vars))
#load inventory mapping table
mapping$ids <- paste(row.names(mapping),mapping$subsector_ssp, mapping$gas,sep="_")
#now create those new columns in the simulation data set
for  (i in 1:nrow(mapping))
{
#i<- 63
tvars <- mapping$vars[i]
tvars <- unlist(strsplit(tvars,":"))
tvars <- subset(tvars,tvars%in%colnames(data))
if (length(tvars)>1) {
data [,mapping$ids[i]] <- rowSums(data[,tvars])
} else if (length(tvars)==1 )
{
data [,mapping$ids[i]] <- data[,tvars]
} else {
data [,mapping$ids[i]] <- 0
}
}
#now we just keep the new variables and the time period which we will reduce to above 2022
data_new <- data [,c(id_vars,mapping$ids)]
dim(data_new)
#convert from wide to long
data_new <- data.table(data_new)
data_new <- reshape2::melt(data_new, id.vars = id_vars,
measure.vars = mapping$ids,
)
data_new <- data.frame(data_new)
data_new$ids <- as.character(data_new$variable)
#merge with mapping
mapping$vars <- NULL
colnames(mapping) <- gsub("mex_sector","CSC.Sector",colnames(mapping))
colnames(mapping) <- gsub("mex_subsector","CSC.Subsector",colnames(mapping))
data_new <- merge(data_new, mapping,by="ids")
#now aggregare at inventory level
data_new <- aggregate(list(value=data_new$value),by=list(primary_id=data_new$primary_id,
time_period=data_new$time_period,
ID=data_new$ID,
mex_sector=data_new$CSC.Sector,
mex_subsector=data_new$CSC.Subsector),sum)
data_new$Year <- data_new$time_period + 2015
data_new$Gas <- do.call("rbind",strsplit(data_new$ID,":"))[,2]
#merge additional files
att <- read.csv(paste0(dir.output,"ATTRIBUTE_PRIMARY.csv"))
head(att)
dim(data_new)
data_new <- merge(data_new,att,by="primary_id")
dim(data_new)
atts <- read.csv(paste0(dir.output,"ATTRIBUTE_STRATEGY.csv"))
#merge
dim(data_new)
data_new <- merge(data_new,atts[c("strategy_id","strategy")],by="strategy_id")
dim(data_new)
#melt edgar data
id_varsEd <- c("Code","mex_sector","mex_subsector","Gas","ID")
measure.vars_Ed <- subset(colnames(edgar),grepl("X",colnames(edgar))==TRUE)
edgar <- data.table(edgar)
edgar <- melt(edgar, id.vars = id_varsEd, measure.vars =measure.vars_Ed)
edgar <- data.frame(edgar)
edgar$Year <- as.numeric(gsub("X","",edgar$variable))
#make sure both data frames have the same columns
#edgar
edgar$variable <- NULL
edgar$strategy_id <- NA
edgar$primary_id <- NA
edgar$design_id <- NA
edgar$future_id <- NA
edgar$Contry <- Country
edgar$strategy <- "Historical"
edgar$source <- "EDGAR"
View(edgar)
edgar <- subset(edgar,Year<=max(edgar$Year))
View(edgar)
# This script prepares the data for emissions mapping in Uganda
file.name <- paste0("decomposed_ssp_output.csv")
iso_code3 <- iso_code3
Country <- region
mapping <- read.csv("ssp_modeling/output_postprocessing/data/inventory/emission_targets_MEX_2023_ni.csv")
# drop "id" directly
mapping$id <- NULL
# drop the column whose name is stored in iso_code3
mapping[[iso_code3]] <- NULL
# names(mapping)
# modification of AG - Livestock:N2O subsector matching
# mapping$Vars[3] <- "emission_co2e_n2o_lsmm_direct_anaerobic_digester:emission_co2e_n2o_lsmm_direct_anaerobic_lagoon:emission_co2e_n2o_lsmm_direct_composting:emission_co2e_n2o_lsmm_direct_daily_spread:emission_co2e_n2o_lsmm_direct_deep_bedding:emission_co2e_n2o_lsmm_direct_dry_lot:emission_co2e_n2o_lsmm_direct_incineration:emission_co2e_n2o_lsmm_direct_liquid_slurry:emission_co2e_n2o_lsmm_direct_paddock_pasture_range:emission_co2e_n2o_lsmm_direct_poultry_manure:emission_co2e_n2o_lsmm_direct_storage_solid:emission_co2e_n2o_lsmm_indirect_anaerobic_digester:emission_co2e_n2o_lsmm_indirect_anaerobic_lagoon:emission_co2e_n2o_lsmm_indirect_composting:emission_co2e_n2o_lsmm_indirect_daily_spread:emission_co2e_n2o_lsmm_indirect_deep_bedding:emission_co2e_n2o_lsmm_indirect_dry_lot:emission_co2e_n2o_lsmm_indirect_incineration:emission_co2e_n2o_lsmm_indirect_liquid_slurry:emission_co2e_n2o_lsmm_indirect_paddock_pasture_range:emission_co2e_n2o_lsmm_indirect_poultry_manure:emission_co2e_n2o_lsmm_indirect_storage_solid"
# add edgar
edgar <- read.csv("ssp_modeling/output_postprocessing/data/inventory/INEGyCEI_historico_wide.csv")
dim(edgar)
edgar <- subset(edgar,Code==iso_code3)
edgar$ID<- paste(edgar$mex_subsector,edgar$Gas,sep=":")
#load data
data <- fread(paste0(dir.output,file.name)) %>% as.data.frame()
data <- subset(data,region==Country)
dim(data)
#order data
setorder(data, primary_id, time_period, region)
#emission vars only
id_vars <-c('region','time_period',"primary_id")
vars <- subset(colnames(data),!(colnames(data)%in%id_vars))
target_vars <- subset(vars,grepl("co2e_",vars)==TRUE)
total_vars <- subset(target_vars,grepl("emission_co2e_subsector_total",target_vars)==TRUE)
target_vars <- subset(target_vars,!(target_vars%in%total_vars))
#load inventory mapping table
mapping$ids <- paste(row.names(mapping),mapping$subsector_ssp, mapping$gas,sep="_")
#now create those new columns in the simulation data set
for  (i in 1:nrow(mapping))
{
#i<- 63
tvars <- mapping$vars[i]
tvars <- unlist(strsplit(tvars,":"))
tvars <- subset(tvars,tvars%in%colnames(data))
if (length(tvars)>1) {
data [,mapping$ids[i]] <- rowSums(data[,tvars])
} else if (length(tvars)==1 )
{
data [,mapping$ids[i]] <- data[,tvars]
} else {
data [,mapping$ids[i]] <- 0
}
}
#now we just keep the new variables and the time period which we will reduce to above 2022
data_new <- data [,c(id_vars,mapping$ids)]
dim(data_new)
#convert from wide to long
data_new <- data.table(data_new)
data_new <- reshape2::melt(data_new, id.vars = id_vars,
measure.vars = mapping$ids,
)
data_new <- data.frame(data_new)
data_new$ids <- as.character(data_new$variable)
#merge with mapping
mapping$vars <- NULL
colnames(mapping) <- gsub("mex_sector","CSC.Sector",colnames(mapping))
colnames(mapping) <- gsub("mex_subsector","CSC.Subsector",colnames(mapping))
data_new <- merge(data_new, mapping,by="ids")
#now aggregare at inventory level
data_new <- aggregate(list(value=data_new$value),by=list(primary_id=data_new$primary_id,
time_period=data_new$time_period,
ID=data_new$ID,
mex_sector=data_new$CSC.Sector,
mex_subsector=data_new$CSC.Subsector),sum)
data_new$Year <- data_new$time_period + 2015
data_new$Gas <- do.call("rbind",strsplit(data_new$ID,":"))[,2]
#merge additional files
att <- read.csv(paste0(dir.output,"ATTRIBUTE_PRIMARY.csv"))
head(att)
dim(data_new)
data_new <- merge(data_new,att,by="primary_id")
dim(data_new)
atts <- read.csv(paste0(dir.output,"ATTRIBUTE_STRATEGY.csv"))
#merge
dim(data_new)
data_new <- merge(data_new,atts[c("strategy_id","strategy")],by="strategy_id")
dim(data_new)
#melt edgar data
id_varsEd <- c("Code","mex_sector","mex_subsector","Gas","ID")
measure.vars_Ed <- subset(colnames(edgar),grepl("X",colnames(edgar))==TRUE)
edgar <- data.table(edgar)
edgar <- melt(edgar, id.vars = id_varsEd, measure.vars =measure.vars_Ed)
edgar <- data.frame(edgar)
edgar$Year <- as.numeric(gsub("X","",edgar$variable))
#make sure both data frames have the same columns
#edgar
edgar$variable <- NULL
edgar$strategy_id <- NA
edgar$primary_id <- NA
edgar$design_id <- NA
edgar$future_id <- NA
edgar$Contry <- Country
edgar$strategy <- "Historical"
edgar$source <- "EDGAR"
edgar <- subset(edgar,Year<=2023)
View(edgar)
year_ref
# This script prepares the data for emissions mapping in Uganda
file.name <- paste0("decomposed_ssp_output.csv")
iso_code3 <- iso_code3
Country <- region
mapping <- read.csv("ssp_modeling/output_postprocessing/data/inventory/emission_targets_MEX_2023_ni.csv")
# drop "id" directly
mapping$id <- NULL
# drop the column whose name is stored in iso_code3
mapping[[iso_code3]] <- NULL
# names(mapping)
# modification of AG - Livestock:N2O subsector matching
# mapping$Vars[3] <- "emission_co2e_n2o_lsmm_direct_anaerobic_digester:emission_co2e_n2o_lsmm_direct_anaerobic_lagoon:emission_co2e_n2o_lsmm_direct_composting:emission_co2e_n2o_lsmm_direct_daily_spread:emission_co2e_n2o_lsmm_direct_deep_bedding:emission_co2e_n2o_lsmm_direct_dry_lot:emission_co2e_n2o_lsmm_direct_incineration:emission_co2e_n2o_lsmm_direct_liquid_slurry:emission_co2e_n2o_lsmm_direct_paddock_pasture_range:emission_co2e_n2o_lsmm_direct_poultry_manure:emission_co2e_n2o_lsmm_direct_storage_solid:emission_co2e_n2o_lsmm_indirect_anaerobic_digester:emission_co2e_n2o_lsmm_indirect_anaerobic_lagoon:emission_co2e_n2o_lsmm_indirect_composting:emission_co2e_n2o_lsmm_indirect_daily_spread:emission_co2e_n2o_lsmm_indirect_deep_bedding:emission_co2e_n2o_lsmm_indirect_dry_lot:emission_co2e_n2o_lsmm_indirect_incineration:emission_co2e_n2o_lsmm_indirect_liquid_slurry:emission_co2e_n2o_lsmm_indirect_paddock_pasture_range:emission_co2e_n2o_lsmm_indirect_poultry_manure:emission_co2e_n2o_lsmm_indirect_storage_solid"
# add edgar
edgar <- read.csv("ssp_modeling/output_postprocessing/data/inventory/INEGyCEI_historico_wide.csv")
dim(edgar)
edgar <- subset(edgar,Code==iso_code3)
edgar$ID<- paste(edgar$mex_subsector,edgar$Gas,sep=":")
#load data
data <- fread(paste0(dir.output,file.name)) %>% as.data.frame()
data <- subset(data,region==Country)
dim(data)
#order data
setorder(data, primary_id, time_period, region)
#emission vars only
id_vars <-c('region','time_period',"primary_id")
vars <- subset(colnames(data),!(colnames(data)%in%id_vars))
target_vars <- subset(vars,grepl("co2e_",vars)==TRUE)
total_vars <- subset(target_vars,grepl("emission_co2e_subsector_total",target_vars)==TRUE)
target_vars <- subset(target_vars,!(target_vars%in%total_vars))
#load inventory mapping table
mapping$ids <- paste(row.names(mapping),mapping$subsector_ssp, mapping$gas,sep="_")
#now create those new columns in the simulation data set
for  (i in 1:nrow(mapping))
{
#i<- 63
tvars <- mapping$vars[i]
tvars <- unlist(strsplit(tvars,":"))
tvars <- subset(tvars,tvars%in%colnames(data))
if (length(tvars)>1) {
data [,mapping$ids[i]] <- rowSums(data[,tvars])
} else if (length(tvars)==1 )
{
data [,mapping$ids[i]] <- data[,tvars]
} else {
data [,mapping$ids[i]] <- 0
}
}
#now we just keep the new variables and the time period which we will reduce to above 2022
data_new <- data [,c(id_vars,mapping$ids)]
dim(data_new)
#convert from wide to long
data_new <- data.table(data_new)
data_new <- reshape2::melt(data_new, id.vars = id_vars,
measure.vars = mapping$ids,
)
data_new <- data.frame(data_new)
data_new$ids <- as.character(data_new$variable)
#merge with mapping
mapping$vars <- NULL
colnames(mapping) <- gsub("mex_sector","CSC.Sector",colnames(mapping))
colnames(mapping) <- gsub("mex_subsector","CSC.Subsector",colnames(mapping))
data_new <- merge(data_new, mapping,by="ids")
#now aggregare at inventory level
data_new <- aggregate(list(value=data_new$value),by=list(primary_id=data_new$primary_id,
time_period=data_new$time_period,
ID=data_new$ID,
mex_sector=data_new$CSC.Sector,
mex_subsector=data_new$CSC.Subsector),sum)
data_new$Year <- data_new$time_period + 2015
data_new$Gas <- do.call("rbind",strsplit(data_new$ID,":"))[,2]
#merge additional files
att <- read.csv(paste0(dir.output,"ATTRIBUTE_PRIMARY.csv"))
head(att)
dim(data_new)
data_new <- merge(data_new,att,by="primary_id")
dim(data_new)
atts <- read.csv(paste0(dir.output,"ATTRIBUTE_STRATEGY.csv"))
#merge
dim(data_new)
data_new <- merge(data_new,atts[c("strategy_id","strategy")],by="strategy_id")
dim(data_new)
#melt edgar data
id_varsEd <- c("Code","mex_sector","mex_subsector","Gas","ID")
measure.vars_Ed <- subset(colnames(edgar),grepl("X",colnames(edgar))==TRUE)
edgar <- data.table(edgar)
edgar <- melt(edgar, id.vars = id_varsEd, measure.vars =measure.vars_Ed)
edgar <- data.frame(edgar)
edgar$Year <- as.numeric(gsub("X","",edgar$variable))
#make sure both data frames have the same columns
#edgar
edgar$variable <- NULL
edgar$strategy_id <- NA
edgar$primary_id <- NA
edgar$design_id <- NA
edgar$future_id <- NA
edgar$Contry <- Country
edgar$strategy <- "Historical"
edgar$source <- "EDGAR"
edgar <- subset(edgar,Year<=year_ref)
#data_new
data_new$time_period <- NULL
data_new$Code <- iso_code3
data_new$Contry <- Country
data_new$source <- "SISEPUEDE"
data_new <- subset(data_new,Year>=year_ref)
#rbind both
data_new <- rbind(data_new,edgar)
data_new <- data_new[order(data_new$strategy_id,
data_new$mex_subsector,
data_new$Gas,
data_new$Year),]
#write file#wristrategyte file
dir.tableau <- paste0("ssp_modeling/tableau/data/")
file.name <- paste0("decomposed_emissions_", region, "_", year_ref,'.csv')
file.name <- paste0("raw_emissions_", region, "_", year_ref,'.csv')
write.csv(data_new,paste0(dir.tableau,file.name),row.names=FALSE)
print('Finish:data_prep_new_mapping process')
#################################################
# Post processing process
#################################################
# load packages
library(data.table)
library(reshape2)
library(mFilter)
library(ggplot2)
library(dplyr)
rm(list=ls())
#ouputfile
dir.output  <- "ssp_modeling/ssp_run_output/sisepuede_results_sisepuede_run_2025-12-08T10;57;12.247508/"
output.file <- "sisepuede_results_sisepuede_run_2025-12-08T10;57;12.247508_WIDE_INPUTS_OUTPUTS.csv"
region <- "mexico"
iso_code3 <- "MEX"
year_ref <- 2023
source('ssp_modeling/output_postprocessing/scr/run_script_baseline_run_new.r')
source('ssp_modeling/output_postprocessing/scr/data_prep_new_mapping.r')
################################################################################
# This script runs the intertemporal decomposition for the baseline run
################################################################################
te_all<-read.csv(paste0("ssp_modeling/output_postprocessing/data/inventory/emission_targets_MEX_2023_ni.csv"))
#te_all <- subset(te_all,Subsector%in%c( "lvst","lsmm","agrc","ippu","waso","trww","frst","lndu","soil"))
# Print shape of te_all
dim(te_all)
target_country <- iso_code3
te_all<-te_all[,c("subsector_ssp","gas","vars","ID",target_country)]
te_all[,"tvalue"] <- te_all[,target_country]
te_all[,target_country] <- NULL
target_vars <- unlist(strsplit(te_all$vars,":"))
# data from SiSePuede
data_all<-fread(paste0(dir.output,output.file)) %>% as.data.frame()
dim(data_all)
rall <- unique(data_all$region)
#set params of rescaling function
initial_conditions_id <- "_0"
time_period_ref <- year_ref-2015
dim(data_all)
data_all <- subset(data_all,time_period>=time_period_ref)
dim(data_all)
data_all$emission_co2e_co2_ippu_production_metals
#################################################
# Post processing process
#################################################
# load packages
library(data.table)
library(reshape2)
library(mFilter)
library(ggplot2)
library(dplyr)
rm(list=ls())
#ouputfile
dir.output  <- "ssp_modeling/ssp_run_output/sisepuede_results_sisepuede_run_2025-12-08T11;36;34.286869/"
output.file <- "sisepuede_results_sisepuede_run_2025-12-08T11;36;34.286869_WIDE_INPUTS_OUTPUTS.csv"
region <- "mexico"
iso_code3 <- "MEX"
year_ref <- 2023
source('ssp_modeling/output_postprocessing/scr/run_script_baseline_run_new.r')
source('ssp_modeling/output_postprocessing/scr/data_prep_new_mapping.r')
source('ssp_modeling/output_postprocessing/scr/data_prep_drivers.r')
